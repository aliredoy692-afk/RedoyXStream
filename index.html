<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
        <title>RedoyXStream - Watch Free Anime & Movies Online</title>
    <meta name="description" content="Watch high-quality Anime & Movies online for free on RedoyXStream. Stream Naruto, One Piece, JJK, and more with English Sub and Dub. No ads, fast streaming server.">
    <meta name="keywords" content="RedoyXStream, anime, watch anime online, free anime, naruto, one piece, jujutsu kaisen, anime streaming, bangla anime site, donghua">
    <meta name="author" content="RedoyXStream">
    
    <meta property="og:title" content="RedoyXStream - Ultimate Anime Streaming">
    <meta property="og:description" content="Watch your favorite anime in HD for free. Join RedoyXStream now!">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://aliredoy692-afk.github.io/RedoyXStream/">
    <meta property="og:image" content="https://i.ibb.co/vz4gk6r/icon.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --primary: #ff0040; --bg: #000000; --card: #111; --text: #e0e0e0; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; overflow-x: hidden; padding-bottom: 80px; }

        /* SERVER SELECTION */
        #serverSelector, #searchOverlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 9000; flex-direction: column; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
        .selector-box { text-align: center; width: 90%; }
        .server-btn { width: 100%; max-width: 320px; padding: 15px; margin: 10px auto; border: 1px solid var(--primary); border-radius: 10px; background: #111; color: white; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; transition: 0.3s; font-size: 14px; }
        .server-btn:active { transform: scale(0.95); background: var(--primary); }

        /* TOP BAR */
        .top-bar { padding: 12px 15px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; background: rgba(0,0,0,0.95); z-index: 1000; border-bottom: 1px solid #1a1a1a; }
        .logo { font-size: 20px; font-weight: 900; color: white; }
        .logo span { color: var(--primary); }
        .search-icon { font-size: 20px; color: white; cursor: pointer; }

        /* SEARCH INPUT */
        .search-box-container { display: flex; width: 85%; gap: 10px; position: relative; }
        .search-input { flex: 1; padding: 15px; background: #222; border: 1px solid #444; color: white; border-radius: 8px; outline: none; font-size: 16px; }
        .go-btn { padding: 0 25px; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: 900; cursor: pointer; font-size: 16px; }
        .close-search { position: absolute; top: -50px; right: 0; font-size: 30px; cursor: pointer; color: #fff; }

        /* HERO SLIDER */
        .hero-slider { position: relative; width: 100%; height: 280px; overflow: hidden; mask-image: linear-gradient(to bottom, black 85%, transparent 100%); }
        .slide { position: absolute; inset: 0; background-size: cover; background-position: center; opacity: 0; transition: opacity 1s ease-in-out; }
        .slide.active { opacity: 1; }
        .slide-overlay { position: absolute; inset: 0; background: linear-gradient(to top, #000 10%, transparent 100%); }
        .slide-content { position: absolute; bottom: 40px; left: 15px; z-index: 10; width: 85%; }
        .slide-title { font-size: 24px; font-weight: 900; color: white; text-shadow: 2px 2px 4px black; margin-bottom: 10px; line-height: 1.2; }

        /* SECTIONS */
        .section { margin-top: 25px; padding-left: 15px; }
        .sec-head { display: flex; justify-content: space-between; align-items: center; padding-right: 15px; margin-bottom: 12px; }
        .sec-title { font-size: 17px; font-weight: 800; border-left: 4px solid var(--primary); padding-left: 10px; color: #fff; }
        .see-all { font-size: 11px; color: var(--primary); font-weight: 700; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; }

        /* CARDS */
        .row { display: flex; gap: 12px; overflow-x: auto; scrollbar-width: none; padding-bottom: 10px; }
        .row::-webkit-scrollbar { display: none; }
        .card { min-width: 105px; width: 105px; position: relative; cursor: pointer; transition: transform 0.2s; }
        .card:active { transform: scale(0.95); }
        .card img { width: 100%; height: 155px; object-fit: cover; border-radius: 8px; border: 1px solid #222; }
        .card-title { font-size: 11px; margin-top: 6px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #ccc; font-weight: 600; text-align: center; }
        .hd-tag { position: absolute; top: 5px; right: 5px; background: var(--primary); color: white; font-size: 9px; padding: 2px 6px; border-radius: 4px; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.5); }

        /* GRID / LIST VIEW */
        #searchGrid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding-bottom: 20px; }
        .load-more-btn { width: 100%; padding: 15px; background: #1a1a1a; color: white; border: 1px solid #333; margin-top: 20px; cursor: pointer; font-weight: bold; border-radius: 8px; }
        
        /* SCHEDULE VIEW */
        .schedule-list { display: flex; flex-direction: column; gap: 15px; padding: 15px; }
        .schedule-item { display: flex; gap: 15px; background: #111; padding: 10px; border-radius: 10px; border-bottom: 1px solid #222; align-items: center; }
        .schedule-img { width: 80px; height: 110px; object-fit: cover; border-radius: 6px; }
        .schedule-info { flex: 1; }
        .schedule-title { font-weight: bold; color: white; font-size: 15px; margin-bottom: 5px; }
        .schedule-time { color: var(--primary); font-size: 12px; font-weight: bold; }
        .schedule-desc { color: #888; font-size: 11px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; margin-top: 5px;}

        /* PLAYER */
        #playerModal { display: none; position: fixed; inset: 0; background: black; z-index: 9999; flex-direction: column; }
        #stickerBar { width: 100%; height: 50px; background: #000; display: flex; align-items: center; justify-content: center; border-bottom: 2px solid var(--primary); color: var(--primary); font-weight: 900; z-index: 10001; position: relative; }
        .back-btn { position: absolute; left: 15px; color: white; font-size: 24px; cursor: pointer; }
        .iframe-container { flex-grow: 1; width: 100%; background: #000; position: relative; overflow: hidden; }
        iframe { width: 100%; height: calc(100% + 100px); margin-top: -65px; border: none; }

        /* BOTTOM NAV */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(0,0,0,0.95); backdrop-filter: blur(5px); display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid #1a1a1a; z-index: 5000; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #666; font-size: 10px; cursor: pointer; transition: 0.3s; }
        .nav-item.active { color: var(--primary); transform: translateY(-2px); }
        .nav-item i { font-size: 20px; margin-bottom: 4px; }

        /* VIEWS */
        .view { display: none; animation: fadeIn 0.3s; }
        #homeView { display: block; }
        #searchView { padding: 15px; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div id="searchOverlay">
        <div class="search-box-container">
            <i class="fas fa-times close-search" onclick="closeSearch()"></i>
            <input type="text" id="searchInput" class="search-input" placeholder="Search Anime (e.g. Naruto)..." onkeyup="if(event.key==='Enter') doSearch()">
            <button class="go-btn" onclick="doSearch()">GO</button>
        </div>
    </div>

    <div id="serverSelector">
        <div class="selector-box">
            <h2 style="color:white; margin-bottom:20px;">SELECT SERVER ðŸ¥°</h2>
            <div class="server-btn" onclick="startPlayer(1)">
                <i class="fas fa-closed-captioning"></i> Server 1 (ENG Sub/Dub)
            </div>
            <div class="server-btn" onclick="startPlayer(2)">
                <i class="fas fa-language"></i> Server 2 (Hindi - If Available)
            </div>
            <button style="margin-top:20px; background:none; border:none; color:#888; text-decoration:underline; cursor:pointer;" onclick="closeSelector()">Close Menu</button>
        </div>
    </div>

    <div class="top-bar">
        <div class="logo">Redoy<span>X</span>Stream</div>
        <i class="fas fa-search search-icon" onclick="openSearch()"></i>
    </div>

    <div id="homeView" class="view">
        <div class="hero-slider" id="heroSlider"></div>
        
        <div id="continueWatchingArea"></div>

        <div class="section">
            <div class="sec-head">
                <div class="sec-title">ðŸ”¥ Trending Now</div>
                <div class="see-all" onclick="initLoadMore('trending', '')">See All</div>
            </div>
            <div class="row" id="trendingRow"></div>
        </div>

        <div class="section">
            <div class="sec-head">
                <div class="sec-title">ðŸŽ¬ Top Anime Movies</div>
                <div class="see-all" onclick="initLoadMore('movie', '')">See All</div>
            </div>
            <div class="row" id="movieRow"></div>
        </div>

        <div id="dynamicGenreSections"></div>
        <br><br>
    </div>

    <div id="scheduleView" class="view">
        <div class="sec-head" style="padding:15px;">
            <div class="sec-title">ðŸ“… Weekly Schedule</div>
        </div>
        <div class="schedule-list" id="scheduleList">
            <p style="color:#666; text-align:center;">Loading Schedule...</p>
        </div>
    </div>

    <div id="searchView" class="view">
        <div class="sec-head">
            <div class="sec-title" id="listTitle">Results</div>
            <div class="see-all" onclick="switchTab('home')">Back Home</div>
        </div>
        <div class="search-grid" id="searchGrid"></div>
        <button id="loadMoreBtn" class="load-more-btn" onclick="loadMoreData()">LOAD MORE ANIME</button>
    </div>

    <div id="playerModal">
        <div id="stickerBar">
            <i class="fas fa-arrow-left back-btn" onclick="closePlayer()"></i>
            <span>DEAR USER PLEASE SCROLL ðŸ¥°</span>
        </div>
        <div class="iframe-container">
            <iframe id="iframe" src="" allowfullscreen sandbox="allow-scripts allow-same-origin allow-forms allow-presentation"></iframe>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('home', this)"><i class="fas fa-home"></i> Home</div>
        <div class="nav-item" onclick="switchTab('schedule', this)"><i class="fas fa-calendar-alt"></i> Schedule</div>
        <div class="nav-item" onclick="openSearch()"><i class="fas fa-search"></i> Search</div>
    </div>

    <script>
        const API_KEY = '15d2ea6d0dc1d476efbca3eba2b9bbfb';
        const BASE = 'https://api.themoviedb.org/3';
        
        // GLOBAL STATE
        let currentPage = 1;
        let currentMode = ''; 
        let currentParam = ''; 
        let selectedAnimeName = '';

        // 5 SPECIFIC CATEGORIES
        const genres = [
            {id: 10759, name: "Action & Adventure"},
            {id: 16, name: "Animation"},
            {id: 14, name: "Fantasy"},
            {id: 10765, name: "Sci-Fi"},
            {id: 35, name: "Comedy"}
        ];

        // --- FILTER (JAPANESE & CHINESE ONLY) ---
        function isAsianAnime(item) {
            return (item.original_language === 'ja' || item.original_language === 'zh' || item.original_language === 'cn');
        }

        const escapeTitle = (t) => t.replace(/'/g, "\\'").replace(/"/g, '&quot;');
        
        // --- WATCH HISTORY ---
        function saveHistory(name, poster) {
            let hist = JSON.parse(localStorage.getItem('redoy_hist') || '[]');
            hist = hist.filter(h => h.name !== name); 
            hist.unshift({name, poster}); 
            if(hist.length > 15) hist.pop(); 
            localStorage.setItem('redoy_hist', JSON.stringify(hist));
            renderContinueWatching();
        }

        function renderContinueWatching() {
            const hist = JSON.parse(localStorage.getItem('redoy_hist') || '[]');
            const area = document.getElementById('continueWatchingArea');
            if(hist.length === 0) { area.innerHTML = ''; return; }
            
            let html = `
                <div class="section">
                    <div class="sec-head"><div class="sec-title">ðŸ•’ Continue Watching</div></div>
                    <div class="row">`;
            hist.forEach(h => {
                html += `
                    <div class="card" onclick="openSelector('${escapeTitle(h.name)}', '${h.poster}')">
                        <div class="hd-tag" style="background:var(--primary)">RESUME</div>
                        <img src="${h.poster}" onerror="this.src='https://via.placeholder.com/100x150?text=No+Img'">
                        <div class="card-title">${h.name}</div>
                    </div>`;
            });
            html += `</div></div>`;
            area.innerHTML = html;
        }

        // --- CORE LOADERS ---
        async function loadHome() {
            renderContinueWatching();

            // 1. HERO SLIDER (Rare/Popular Anime)
            // Using 'popular' instead of 'trending' to ensure hits like Naruto/One Piece show up
            const heroRes = await fetch(`${BASE}/discover/tv?api_key=${API_KEY}&with_genres=16&sort_by=vote_count.desc&with_original_language=ja&page=1`);
            const heroData = await heroRes.json();
            const slider = document.getElementById('heroSlider');
            
            const animeSlides = heroData.results.slice(0, 15);
            
            slider.innerHTML = '';
            animeSlides.forEach((a, i) => {
                let img = a.backdrop_path ? `https://image.tmdb.org/t/p/w780${a.backdrop_path}` : `https://image.tmdb.org/t/p/w500${a.poster_path}`;
                slider.innerHTML += `
                    <div class="slide ${i===0?'active':''}" style="background-image:url('${img}')">
                        <div class="slide-overlay"></div>
                        <div class="slide-content">
                            <div class="slide-title">${a.name || a.title}</div>
                            <button class="server-btn" style="width:auto; padding:8px 25px; margin:0; font-size:12px;" 
                                onclick="openSelector('${escapeTitle(a.name||a.title)}', 'https://image.tmdb.org/t/p/w300${a.poster_path}')">
                                <i class="fas fa-play"></i> WATCH NOW
                            </button>
                        </div>
                    </div>`;
            });

            // 2. TRENDING ROW
            renderRow('trendingRow', `${BASE}/trending/tv/week?api_key=${API_KEY}`);

            // 3. TOP MOVIES (Fixed with strict Japanese filter in URL)
            renderRow('movieRow', `${BASE}/discover/movie?api_key=${API_KEY}&with_genres=16&sort_by=revenue.desc&with_original_language=ja`);

            // 4. 5 CATEGORIES
            const gContainer = document.getElementById('dynamicGenreSections');
            // Using IDs for Action, Fantasy, Sci-Fi, Slice of Life(Drama), Comedy
            const homeGenres = [10759, 14, 10765, 35, 18]; 
            
            for(let gID of homeGenres) {
                const gName = genres.find(g => g.id === gID)?.name || "Anime";
                const div = document.createElement('div');
                div.className = 'section';
                div.innerHTML = `
                    <div class="sec-head">
                        <div class="sec-title">${gName}</div>
                        <div class="see-all" onclick="initLoadMore('genre', ${gID}, '${gName}')">See All</div>
                    </div>
                    <div class="row" id="g-row-${gID}"></div>`;
                gContainer.appendChild(div);
                renderRow(`g-row-${gID}`, `${BASE}/discover/tv?api_key=${API_KEY}&with_genres=16,${gID}&sort_by=popularity.desc&with_original_language=ja`);
            }
        }

        async function renderRow(id, url) {
            const res = await fetch(url);
            const data = await res.json();
            const container = document.getElementById(id);
            
            // Filter: Poster Exists AND Language is JA/ZH/CN
            const valid = data.results.filter(x => x.poster_path && isAsianAnime(x));
            
            valid.forEach(a => {
                let name = a.name || a.title;
                let poster = `https://image.tmdb.org/t/p/w300${a.poster_path}`;
                container.innerHTML += `
                    <div class="card" onclick="openSelector('${escapeTitle(name)}', '${poster}')">
                        <img src="${poster}" loading="lazy">
                        <div class="card-title">${name}</div>
                    </div>`;
            });
        }

        // --- SCHEDULE LOADING ---
        async function loadSchedule() {
            const list = document.getElementById('scheduleList');
            list.innerHTML = '<p style="color:#666; text-align:center;">Checking schedule...</p>';
            
            // Get Dates for Next 7 Days
            const today = new Date().toISOString().split('T')[0];
            const nextWeek = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];

            const url = `${BASE}/discover/tv?api_key=${API_KEY}&with_genres=16&with_original_language=ja&air_date.gte=${today}&air_date.lte=${nextWeek}&sort_by=popularity.desc`;
            
            const res = await fetch(url);
            const data = await res.json();
            const items = data.results.filter(x => x.poster_path);

            list.innerHTML = '';
            if(items.length === 0) {
                 list.innerHTML = '<p style="color:#666; text-align:center;">No schedule info available.</p>';
                 return;
            }

            items.forEach(a => {
                let name = a.name;
                let date = a.first_air_date || "Coming Soon";
                let poster = `https://image.tmdb.org/t/p/w200${a.poster_path}`;
                let desc = a.overview || "No description available.";
                
                list.innerHTML += `
                    <div class="schedule-item" onclick="openSelector('${escapeTitle(name)}', '${poster}')">
                        <img src="${poster}" class="schedule-img">
                        <div class="schedule-info">
                            <div class="schedule-title">${name}</div>
                            <div class="schedule-time">ðŸ“… Airs: ${date}</div>
                            <div class="schedule-desc">${desc}</div>
                        </div>
                    </div>`;
            });
        }

        // --- UNLIMITED LOADING ---
        function initLoadMore(mode, param, titleOverride) {
            currentMode = mode;
            currentParam = param;
            currentPage = 1; 
            document.getElementById('searchGrid').innerHTML = ''; 
            document.getElementById('loadMoreBtn').style.display = 'block'; 
            
            let title = "Results";
            if(mode === 'trending') title = "All Trending Anime";
            if(mode === 'movie') title = "Top Anime Movies";
            if(mode === 'genre') title = genres.find(g => g.id === param)?.name + " Anime";
            if(titleOverride) title = titleOverride;
            
            document.getElementById('listTitle').innerText = title;
            switchTab('search');
            loadMoreData(); 
        }

        async function loadMoreData() {
            let url = '';
            // STRICT JAPANESE LANGUAGE ENFORCED IN URLS
            if(currentMode === 'trending') {
                url = `${BASE}/discover/tv?api_key=${API_KEY}&with_genres=16&sort_by=popularity.desc&with_original_language=ja&page=${currentPage}`;
            } else if(currentMode === 'movie') {
                url = `${BASE}/discover/movie?api_key=${API_KEY}&with_genres=16&sort_by=revenue.desc&with_original_language=ja&page=${currentPage}`;
            } else if(currentMode === 'genre') {
                url = `${BASE}/discover/tv?api_key=${API_KEY}&with_genres=${currentParam},16&sort_by=popularity.desc&with_original_language=ja&page=${currentPage}`;
            } else if(currentMode === 'search') {
                url = `${BASE}/search/multi?api_key=${API_KEY}&query=${currentParam}&page=${currentPage}`;
            }

            const btn = document.getElementById('loadMoreBtn');
            btn.innerText = "LOADING...";
            
            try {
                const res = await fetch(url);
                const data = await res.json();
                const grid = document.getElementById('searchGrid');
                
                // Filter again client side just in case
                const items = data.results.filter(x => 
                    x.poster_path && 
                    isAsianAnime(x) && 
                    (currentMode !== 'search' || x.media_type !== 'person')
                );

                if(items.length === 0 && currentPage === 1) {
                    grid.innerHTML = '<p style="grid-column:1/-1; text-align:center; color:#666;">No results found.</p>';
                    btn.style.display = 'none';
                } else if (items.length === 0 && currentPage > 1) {
                    currentPage++;
                    loadMoreData(); // Skip empty pages
                    return;
                } else {
                    items.forEach(a => {
                        let name = a.name || a.title;
                        let poster = `https://image.tmdb.org/t/p/w300${a.poster_path}`;
                        grid.innerHTML += `
                            <div class="card" style="width:100%" onclick="openSelector('${escapeTitle(name)}', '${poster}')">
                                <div class="hd-tag">${a.vote_average ? a.vote_average.toFixed(1) : 'NEW'}</div>
                                <img src="${poster}" loading="lazy">
                                <div class="card-title">${name}</div>
                            </div>`;
                    });
                    currentPage++; 
                    btn.innerText = "LOAD MORE ANIME";
                }
            } catch (e) {
                console.error(e);
                btn.innerText = "ERROR LOADING";
            }
        }

        // --- SEARCH & PLAYER ---
        function doSearch() {
            const q = document.getElementById('searchInput').value.trim();
            if(!q) return;
            closeSearch();
            initLoadMore('search', q, `Search: ${q}`);
        }
        function openSearch() { document.getElementById('searchOverlay').style.display = 'flex'; document.getElementById('searchInput').focus(); }
        function closeSearch() { document.getElementById('searchOverlay').style.display = 'none'; }

        function openSelector(name, poster) {
            selectedAnimeName = name;
            saveHistory(name, poster); 
            document.getElementById('serverSelector').style.display = 'flex';
        }
        function closeSelector() { document.getElementById('serverSelector').style.display = 'none'; }
        
        function startPlayer(server) {
            closeSelector();
            const q = encodeURIComponent(selectedAnimeName);
            let url = '';
            if(server === 1) url = `https://aniwatchtv.to/search?keyword=${q}`;
            if(server === 2) url = `https://watchanimeworld.net/?s=${q}`;
            
            document.getElementById('playerModal').style.display = 'flex';
            document.getElementById('iframe').src = url;
        }
        function closePlayer() {
            document.getElementById('playerModal').style.display = 'none';
            document.getElementById('iframe').src = '';
        }

        function switchTab(tab, btn) {
            document.querySelectorAll('.view').forEach(v => v.style.display = 'none');
            
            if(tab === 'home') document.getElementById('homeView').style.display = 'block';
            else if(tab === 'search') document.getElementById('searchView').style.display = 'block';
            else if(tab === 'schedule') {
                document.getElementById('scheduleView').style.display = 'block';
                loadSchedule();
            }

            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            if(btn) btn.classList.add('active');
            else if(tab==='home') document.querySelectorAll('.nav-item')[0].classList.add('active');
        }

        setInterval(() => {
            const slides = document.querySelectorAll('.slide');
            if(slides.length > 0) {
                let activeIndex = Array.from(slides).findIndex(s => s.classList.contains('active'));
                slides[activeIndex].classList.remove('active');
                slides[(activeIndex + 1) % slides.length].classList.add('active');
            }
        }, 4000);

        loadHome();

    </script>
</body>
</html>
